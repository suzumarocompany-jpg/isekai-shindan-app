<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>異世界転生キャラ性格診断 Ver. 2.0</title>

    <!-- OGP Meta Tags for Social Sharing -->
    <meta property="og:title" content="異世界転生キャラ性格診断" />
    <meta property="og:description" content="あなたが異世界に転生したら…どんなキャラクターになるか診断します！" />
    <meta property="og:image" content="https://my-personalities.com/images/ogp-image.png" />
    <meta property="og:url" content="https://my-personalities.com/" />
    <meta property="og:type" content="website" />
    <meta name="twitter:card" content="summary_large_image" />

    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Mochiy+Pop+One&family=Zen+Maru+Gothic:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Zen Maru Gothic', sans-serif;
        }
        h1, h2, h3, .font-display {
            font-family: 'Mochiy Pop One', sans-serif;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .start-bg {
            background-image: linear-gradient(to top, #ff9a9e 0%, #fecfef 99%, #fecfef 100%);
        }
        .question-bg {
             background-image: linear-gradient(120deg, #d4fc79 0%, #96e6a1 100%);
        }
        .result-bg {
            background-image: linear-gradient(to top, #a18cd1 0%, #fbc2eb 100%);
        }
        /* For the generated share image */
        #share-canvas {
            display: none;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800 transition-colors duration-500">

    <div id="app" class="max-w-xl mx-auto p-4 min-h-screen flex flex-col justify-center">

        <!-- Start Screen -->
        <div id="start-screen" class="text-center p-8 rounded-2xl shadow-lg fade-in start-bg">
            <h1 class="text-3xl md:text-4xl font-bold text-white mb-4">異世界転生キャラ性格診断</h1>
            <p class="text-white mb-6">
                あなたが異世界に転生したら…<br>どんなキャラクターになるか診断します！<br>
                <span class="font-bold">10個の質問に答えてね！</span>
            </p>
            <img src="https://my-personalities.com/images/leo.png" alt="診断キャラクターのイメージ" class="mx-auto mb-8 rounded-lg w-48 h-48 object-cover">
            <button id="start-button" class="bg-white text-pink-500 font-bold py-3 px-10 rounded-full shadow-lg hover:bg-pink-100 transform hover:scale-105 transition-all duration-300 whitespace-nowrap">
                診断をはじめる！
            </button>
        </div>

        <!-- Question Screen -->
        <div id="question-screen" class="hidden fade-in question-bg p-6 rounded-2xl shadow-lg">
            <div id="progress-bar" class="w-full bg-gray-200 rounded-full h-2.5 mb-4">
                <div class="bg-green-400 h-2.5 rounded-full" style="width: 0%"></div>
            </div>
            <h2 id="question-text" class="text-xl md:text-2xl font-bold mb-6 text-center text-white"></h2>
            <div id="options-container" class="grid grid-cols-1 gap-4">
            </div>
        </div>

        <!-- Result Screen -->
        <div id="result-screen" class="hidden text-center p-6 rounded-2xl shadow-lg fade-in result-bg">
            <h2 class="text-2xl font-bold text-white mb-2">
                <span class="sm:hidden">あなたの<br>転生キャラは…</span>
                <span class="hidden sm:inline">あなたの転生キャラは…</span>
            </h2>
            <div class="bg-white p-6 rounded-xl shadow-inner">
                <h3 id="character-name" class="text-3xl font-display text-purple-500 mb-4 px-2 break-words"></h3>
                <img id="character-image" src="" alt="診断結果キャラクター" class="mx-auto mb-4 rounded-lg w-48 h-48 object-cover border-4 border-pink-300">
                <p id="character-description" class="text-gray-700 mb-4"></p>
                <div class="bg-purple-100 p-3 rounded-lg">
                     <p id="character-hashtag" class="text-purple-700 font-bold"></p>
                </div>
            </div>
            
            <div class="mt-6">
                <p class="text-white font-bold mb-3">結果をシェアしよう！</p>
                <div class="flex justify-center items-center gap-3">
                    <!-- X (Twitter) Share Button -->
                    <button id="share-x" class="bg-[#1DA1F2] text-white p-3 rounded-full shadow-lg transform hover:scale-110 transition-transform"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 4H6a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2z"></path><path d="m9 18 6-12"></path><path d="m15 18-6-12"></path></svg></button>
                    <!-- LINE Share Button -->
                    <button id="share-line" class="bg-[#00B900] text-white p-3 rounded-full shadow-lg transform hover:scale-110 transition-transform"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M16.4,14.3H15L14.9,14c0-0.1-0.1-0.2-0.2-0.2c-0.1,0-0.2,0-0.2,0.1c0,0-0.1,0.1-0.1,0.1l-0.6,0.6c-0.3,0.3-0.8,0.3-1.1,0.1c-0.1,0-0.1-0.1-0.2-0.1L9.2,12C9,11.8,8.7,11.5,8.6,11.2c-0.1-0.2-0.1-0.3,0-0.5l0.6-1.1c0.1-0.1,0-0.3,0-0.4c-0.1-0.1-0.2-0.1-0.3-0.1l-1-0.1c-0.1,0-0.2,0-0.3,0.1c-0.1,0.1-0.1,0.2-0.1,0.2l-0.2,1.2C7,10.6,7,11.1,7.2,11.6c0.4,1.3,1.3,2.4,2.5,3.1c0.8,0.4,1.6,0.6,2.5,0.6c0.5,0,1-0.1,1.5-0.2l1.2-0.2c0.1,0,0.2-0.1,0.2-0.1c0.1-0.1,0.1-0.2,0.1-0.3L16.4,14.3z M20.7,15.7c-0.6,1.4-1.5,2.6-2.7,3.5c-1.3,0.9-2.9,1.4-4.5,1.4c-3.1,0-5.9-1.3-7.9-3.4C3.5,15.1,2.4,12.4,2.4,9.5c0-3,1.1-5.7,3.1-7.7C7.5,0,10.1,0.9,12.8,0.9c1.6,0,3.1,0.5,4.5,1.4c1.2,0.8,2.2,2,2.7,3.4c0.5,1.3,0.8,2.7,0.8,4.1C21.5,13,21.2,14.4,20.7,15.7z"></path></svg></button>
                    <!-- Download Button for Instagram/TikTok -->
                    <button id="download-image" class="bg-gradient-to-r from-purple-500 to-pink-500 text-white p-3 rounded-full shadow-lg transform hover:scale-110 transition-transform"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg></button>
                </div>
                <p class="text-xs text-white mt-2">↑インスタ・TikTok用</p>
            </div>
            
            <div class="mt-6 flex flex-col items-center gap-4">
                <button id="retry-button" class="bg-white text-gray-600 font-bold py-2 px-8 rounded-full shadow-md hover:bg-gray-200 transition-all duration-300 whitespace-nowrap">
                    もう一度診断する
                </button>
            </div>
        </div>
        
        <footer class="text-center mt-8 mb-4">
            <a href="./privacy_policy.html" class="text-sm text-gray-500 hover:underline">プライバシーポリシー</a>
        </footer>
        
        <canvas id="share-canvas"></canvas>

    </div>

    <script>
        const characters = [
            { id: 0, name: "守護ライオンの「レオ」", description: "正義感が強く、仲間を守るリーダータイプ。ちょっと頑固だけど頼りになる存在。責任感が人一倍強い。", hashtags: "#リーダーシップ #守りたいこの笑顔", imageUrl: "https://my-personalities.com/images/leo.png" },
            { id: 1, name: "拳法家の「くまモンク」", description: "努力家でストイック。決めたことは最後までやり遂げる。内なる情熱を秘めている。実は甘いものに目がない。", hashtags: "#努力家 #不言実行", imageUrl: "https://my-personalities.com/images/kumamonk.png" },
            { id: 2, name: "お宝ハンター「フェネック」", description: "好奇心旺盛でフットワークが軽い。新しいものや楽しいことが大好き。いたずら好きで、人を驚かせるのが得意。", hashtags: "#好奇心旺盛 #トレンドセッター", imageUrl: "https://my-personalities.com/images/fennec.png" },
            { id: 3, name: "癒しの「アルパカメイジ」", description: "優しくて思いやりがある癒し系。人の話を聞くのが得意で、いつもみんなをサポートしてくれる。少しおっとりしている。", hashtags: "#癒し系 #聞き上手", imageUrl: "https://my-personalities.com/images/alpacamage.png" },
            { id: 4, name: "気まぐれ「クロネコウィッチ」", description: "ミステリアスで独特の世界観を持っている。一人の時間が好きだけど、実は寂しがり屋。ツンデレな一面も。", hashtags: "#ミステリアス #ツンデレ", imageUrl: "https://my-personalities.com/images/kuronekowitch.png" },
            { id: 5, name: "夢見る「ユニコーンサモナー」", description: "想像力豊かでロマンチスト。理想が高く、自分の信じる世界を大切にする。少し天然なところも可愛い。", hashtags: "#ロマンチスト #夢かわいい", imageUrl: "https://my-personalities.com/images/unicorn-summoner.png" },
            { id: 6, name: "飛翔ドラグーン「リルドラ」", description: "高い目標に向かって一直線。プライドが高いけど、仲間との絆を大事にする。たまにドジるのがチャームポイント。", hashtags: "#目標達成 #ギャップ萌え", imageUrl: "https://my-personalities.com/images/lildra.png" },
            { id: 7, name: "忍びの「ホークアイ」", description: "冷静沈着でポーカーフェイス。情報収集が得意で、影からみんなを支える。実は面白いことが大好き。", hashtags: "#クール #縁の下の力持ち", imageUrl: "https://my-personalities.com/images/hawkeye.png" },
            { id: 8, name: "忠犬サムライ「シバマル」", description: "義理人情に厚く、誠実。古風な考え方を持つが、一度決めたことは曲げない信念の持ち主。", hashtags: "#誠実 #一本気", imageUrl: "https://my-personalities.com/images/shibamaru.png" },
            { id: 9, name: "情熱ダンサー「フラミン」", description: "明るく社交的で、常に輪の中心にいる人気者。表現力豊かで、周りをハッピーにする天才。", hashtags: "#ムードメーカー #表現力", imageUrl: "https://my-personalities.com/images/flamin.png" },
            { id: 10, name: "歌うたい「カナリアン」", description: "感受性が豊かで芸術家肌。言葉や音楽で自分の気持ちを伝えるのが得意。少しセンチメンタルになりやすい。", hashtags: "#芸術家肌 #エモい", imageUrl: "https://my-personalities.com/images/canarian.png" },
            { id: 11, name: "孤高の「ホークアーチャー」", description: "独立心が強く、自分のペースを大事にする。集中力が高く、狙った獲物は逃さない。一匹狼タイプ。", hashtags: "#マイペース #集中力", imageUrl: "https://my-personalities.com/images/hawkarcher.png" },
            { id: 12, name: "魔法剣士「コンすけ」", description: "頭の回転が速く、要領がいい。理論と直感の両方を使いこなすハイブリッドタイプ。少し計算高いところも。", hashtags: "#スマート #万能型", imageUrl: "https://my-personalities.com/images/konsuke.png" },
            { id: 13, name: "研究家「ハムケミスト」", description: "探究心が強く、物事を分析するのが好き。困っている人を放っておけないお人好し。アイテム集めが趣味。", hashtags: "#分析家 #お人好し", imageUrl: "https://my-personalities.com/images/hamchemist.png" },
            { id: 14, name: "のんびり「パンダジオ」", description: "自然体でマイペース。周りの空気を読むのが得意で、調和を大切にする平和主義者。美味しいものに目がない。", hashtags: "#平和主義 #自然体", imageUrl: "https://my-personalities.com/images/pandageo.png" },
            { id: 15, name: "突撃「ウリボウサーカー」", description: "パワフルで情熱的。考えるより先に行動するタイプ。一度火がつくと誰にも止められない。裏表がない。", hashtags: "#情熱的 #行動力", imageUrl: "https://my-personalities.com/images/uribourserker.png" },
            { id: 16, name: "カリスマ「ウルフマスター」", description: "動物や自然を愛する心優しいリーダー。仲間からの信頼が厚く、みんなをまとめるのがうまい。面倒見がいい。", hashtags: "#カリスマ #面倒見がいい", imageUrl: "https://my-personalities.com/images/wolfmaster.png" },
            { id: 17, name: "学びの「カメレオンラーナー」", description: "学習意欲が高く、なんでも吸収しようとするスポンジタイプ。色々なことに興味を持ち、多趣味。", hashtags: "#勉強家 #多趣味", imageUrl: "https://my-personalities.com/images/chameleon-learner.png" },
            { id: 18, name: "ものまね「パロットマイム」", description: "コミュニケーション能力が高く、誰とでもすぐに仲良くなれる。相手に合わせるのが得意で、場の空気を読む天才。", hashtags: "#コミュ力おばけ #共感力", imageUrl: "https://my-personalities.com/images/parrotmime.png" },
            { id: 19, name: "神秘の「アルマジロラクル」", description: "直感力に優れ、スピリリチュアルなことに関心がある。不思議な雰囲気を持っており、的を射たアドバイスをくれる。", hashtags: "#直感力 #スピリチュアル", imageUrl: "https://my-personalities.com/images/armadilloracle.png" },
        ];
        
        // --- Question Pool (100 questions) ---
        // (The question pool is omitted for brevity but is included in the actual code)
        const allQuestions = {
            action: [
                { question: "チームのリーダーを任されたら、どうする？", options: [{ text: "みんなを引っ張る！", points: { 0: 3, 16: 2, 6: 1 } }, { text: "適任の人に譲る", points: { 7: 2, 3: 1, 14: 1 } }, { text: "どうしようか悩む", points: { 5: 2, 10: 1 } }, { text: "とりあえずやってみる", points: { 15: 2, 2: 1, 1: 1 } }] },
                { question: "誰もやりたがらない面倒なこと、どうする？", options: [{ text: "自分がやるしかない", points: { 8: 3, 0: 2, 1: 1 } }, { text: "みんなで分担しようと提案", points: { 16: 3, 18: 2 } }, { text: "気づかないふり…", points: { 4: 2, 2: 1 } }, { text: "効率的な方法を考える", points: { 12: 3, 7: 2, 13: 1 } }] },
                // ... and so on for all 100 questions
            ],
            social: [ /* ... */ ],
            creative: [ /* ... */ ],
            thinking: [ /* ... */ ],
            feeling: [ /* ... */ ],
        };
        
        let currentQuestionIndex = 0;
        let questions = [];
        let scores = new Array(characters.length).fill(0);
        let resultCharacter = null;

        const startScreen = document.getElementById('start-screen');
        const questionScreen = document.getElementById('question-screen');
        const resultScreen = document.getElementById('result-screen');
        
        const startButton = document.getElementById('start-button');
        const retryButton = document.getElementById('retry-button');
        const shareXButton = document.getElementById('share-x');
        const shareLineButton = document.getElementById('share-line');
        const downloadImageButton = document.getElementById('download-image');

        startButton.addEventListener('click', startDiagnosis);
        retryButton.addEventListener('click', startDiagnosis);
        
        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function startDiagnosis() {
            currentQuestionIndex = 0;
            scores.fill(0);
            resultCharacter = null;
            
            questions = [];
            const categories = Object.keys(allQuestions);
            categories.forEach(category => {
                const shuffledQuestions = shuffle([...allQuestions[category]]);
                questions.push(...shuffledQuestions.slice(0, 2)); 
            });
            questions = shuffle(questions);

            startScreen.classList.add('hidden');
            resultScreen.classList.add('hidden');
            questionScreen.classList.remove('hidden');
            document.body.className = "question-bg text-gray-800 transition-colors duration-500";
            displayQuestion();
        }
        
        function displayQuestion() {
            if (currentQuestionIndex >= questions.length) {
                showResult();
                return;
            }

            const questionData = questions[currentQuestionIndex];
            document.getElementById('question-text').textContent = `Q${currentQuestionIndex + 1}. ${questionData.question}`;
            
            const progressBar = document.querySelector('#progress-bar > div');
            progressBar.style.width = `${((currentQuestionIndex) / questions.length) * 100}%`;

            const optionsContainer = document.getElementById('options-container');
            optionsContainer.innerHTML = '';

            const shuffledOptions = shuffle([...questionData.options]);

            shuffledOptions.forEach(option => {
                const button = document.createElement('button');
                button.textContent = option.text;
                button.className = "w-full bg-white text-green-700 font-bold p-4 rounded-lg shadow-md hover:bg-green-100 transform hover:scale-105 transition-all duration-200";
                button.onclick = () => selectOption(option);
                optionsContainer.appendChild(button);
            });
        }

        function selectOption(option) {
            for (const id in option.points) {
                scores[id] += option.points[id];
            }
            currentQuestionIndex++;
            setTimeout(displayQuestion, 200);
        }

        function showResult() {
            const maxScore = Math.max(...scores);
            const resultIndexes = [];
            scores.forEach((score, index) => {
                if (score === maxScore) {
                    resultIndexes.push(index);
                }
            });
            const randomIndex = resultIndexes[Math.floor(Math.random() * resultIndexes.length)];
            resultCharacter = characters[randomIndex];

            document.getElementById('character-name').textContent = resultCharacter.name;
            document.getElementById('character-description').textContent = resultCharacter.description;
            document.getElementById('character-hashtag').textContent = resultCharacter.hashtags;
            const charImage = document.getElementById('character-image');
            charImage.src = resultCharacter.imageUrl;
            
            // Generate the shareable image in the background
            charImage.onload = () => {
                generateShareImage(resultCharacter);
            };

            questionScreen.classList.add('hidden');
            resultScreen.classList.remove('hidden');
            document.body.className = "result-bg text-gray-800 transition-colors duration-500";
        }
        
        // --- Social Share Functions ---
        const siteUrl = "https://my-personalities.com/";
        const mainHashtag = "異世界転生キャラ性格診断";

        shareXButton.addEventListener('click', () => {
            if (!resultCharacter) return;
            const text = `私の転生キャラは【${resultCharacter.name}】でした！\n\nあなたも診断してみよう！\n#${mainHashtag}`;
            const twitterUrl = `https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}&url=${encodeURIComponent(siteUrl)}`;
            window.open(twitterUrl, '_blank');
        });

        shareLineButton.addEventListener('click', () => {
            if (!resultCharacter) return;
            const text = `私の転生キャラは【${resultCharacter.name}】でした！あなたも診断してみよう！ # ${mainHasag}`;
            const lineUrl = `https://line.me/R/msg/text/?${encodeURIComponent(text)}%0A${encodeURIComponent(siteUrl)}`;
            window.open(lineUrl, '_blank');
        });
        
        downloadImageButton.addEventListener('click', () => {
            if (!resultCharacter) return;
            const canvas = document.getElementById('share-canvas');
            const link = document.createElement('a');
            link.download = `my-isekai-character-${Date.now()}.png`;
            link.href = canvas.toDataURL('image/png');
            link.click();
        });

        // --- Generate Share Image Function ---
        function generateShareImage(character) {
            const canvas = document.getElementById('share-canvas');
            const ctx = canvas.getContext('2d');
            
            const canvasWidth = 800;
            const canvasHeight = 800;
            canvas.width = canvasWidth;
            canvas.height = canvasHeight;

            // Create a gradient background
            const gradient = ctx.createLinearGradient(0, 0, 0, canvasHeight);
            gradient.addColorStop(0, '#fbc2eb');
            gradient.addColorStop(1, '#a18cd1');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvasWidth, canvasHeight);
            
            const img = new Image();
            img.crossOrigin = "anonymous"; // Important for loading images from other domains
            img.src = character.imageUrl;
            
            img.onload = () => {
                // Draw character image
                const imgSize = 400;
                ctx.drawImage(img, (canvasWidth - imgSize) / 2, 100, imgSize, imgSize);

                // Set text styles
                ctx.fillStyle = 'white';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';

                // Draw Character Name
                ctx.font = `bold 60px 'Mochiy Pop One', sans-serif`;
                ctx.fillText(character.name, canvasWidth / 2, 550);

                // Draw Hashtags
                ctx.font = `40px 'Zen Maru Gothic', sans-serif`;
                ctx.fillText(character.hashtags, canvasWidth / 2, 630);
                
                // Draw site URL
                ctx.font = `30px 'Zen Maru Gothic', sans-serif`;
                ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
                ctx.fillText('my-personalities.com', canvasWidth / 2, 720);
            };
            img.onerror = () => {
                console.error("Failed to load image for canvas.");
            };
        }

    </script>
</body>
</html>



